{"version":3,"sources":["common/initCanvas.ts","../node_modules/@babel/runtime/helpers/esm/construct.js","../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","assets/img/disturb.jpg","views/webgl/T3-UseTexture.tsx"],"names":["Threescene","options","_scene","_camera","_renderer","_ambientLight","_directionalLight","_controls","_stats","_options","_animateSign","onWindowResize","aspect","window","innerWidth","innerHeight","updateProjectionMatrix","render","setSize","animate","requestAnimationFrame","update","initObject","props","add","mesh","cancelAnimationFrame","removeObject","remove","destroy","this","THREE","cameraOption","rendererOption","ambientLight","directionalLight","OrbitControls","domElement","Stats","init","position","cameraPosition","set","lookAt","setClearColor","rendererColor","setPixelRatio","devicePixelRatio","node","appendChild","initLight","initControls","initStats","onresize","intensity","lightIntensity","defaultOptions","controls","minDistance","maxDistance","enablePan","enableDamping","dampingFactor","autoRotate","showPanel","dom","_construct","Parent","args","Class","Reflect","construct","sham","Proxy","Date","prototype","toString","call","e","isNativeReflectConstruct","a","push","apply","instance","Function","bind","arguments","_toConsumableArray","arr","Array","isArray","i","arr2","length","iter","Symbol","iterator","Object","from","TypeError","module","exports","UseTexture","initCanvas","canvasNode","antialias","canvas","InitCanvas","setState","objectOptions","image","load","texturesImage","texture","material","map","geometry","Mesh","rotation","x","y","changeImage","_this","state","reads","FileReader","file","target","files","readAsDataURL","onload","base64","result","document","getElementById","className","inverted","color","type","accept","id","onChange","Component"],"mappings":"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","file":"static/js/10.ddef5e78.chunk.js","sourcesContent":["import * as THREE from 'three'\r\nimport { OrbitControls } from 'three-orbitcontrols-ts'\r\nimport Stats from 'stats.js'\r\n\r\n/**\r\n * @method canvasType canvas参数\r\n * @param node 生成结点\r\n * @param cameraOption 相机参数[视野, 显示口的宽高比, 近裁剪面, 远裁剪面]\r\n * @param cameraPosition 相机视点[x, y, z]\r\n * @param renderColor 渲染器颜色\r\n * @param ambientLight 环境光\r\n * @param directionalLight 点光源\r\n * @param lightPosition 光源视点\r\n * @param lightIntensity 曝光度\r\n * @param controls 控制器\r\n */\r\ninterface canvasType {\r\n  node: any\r\n  cameraOption?: number[]\r\n  cameraPosition?: number[]\r\n  rendererOption?: object\r\n  rendererColor?: any\r\n  ambientLight?: any\r\n  directionalLight?: any\r\n  lightPosition?: number[]\r\n  lightIntensity?: number,\r\n  controls?: any\r\n}\r\ninterface GeometryType {\r\n  mesh: THREE.Mesh\r\n  animate?: any\r\n  update?: any\r\n}\r\n\r\nexport default class Threescene {\r\n  private _scene: THREE.Scene\r\n  private _camera: THREE.PerspectiveCamera\r\n  private _renderer: THREE.WebGLRenderer\r\n  private _ambientLight: THREE.AmbientLight\r\n  private _directionalLight: THREE.DirectionalLight\r\n  private _controls: OrbitControls\r\n  private _stats: Stats\r\n  private _options: canvasType\r\n  private _animateSign: number\r\n  public constructor(options: canvasType) {\r\n    this._options = options\r\n    this._scene = new THREE.Scene()\r\n    this._camera = new THREE.PerspectiveCamera(...this._options.cameraOption || [45, window.innerWidth / window.innerHeight, 0.1, 2000])\r\n    this._renderer = new THREE.WebGLRenderer(this._options.rendererOption || {})\r\n    this._ambientLight = new THREE.AmbientLight(this._options.ambientLight || 0x404040)\r\n    this._directionalLight = new THREE.DirectionalLight(this._options.directionalLight || 0xFF0000)\r\n    this._controls = new OrbitControls(this._camera, this._renderer.domElement)\r\n    this._stats = new Stats()\r\n    this._animateSign = 0\r\n    this.init()\r\n  }\r\n  /**\r\n   * @method init 初始化场景\r\n   */\r\n  public init() {\r\n    let position\r\n    this._options.cameraPosition ? position = this._options.cameraPosition : position = [-40, 40, 40]\r\n    this._camera.position.set(position[0], position[1], position[2])\r\n    this._camera.lookAt(this._scene.position)\r\n    this._renderer.setClearColor(this._options.rendererColor || 0x282c34)\r\n    this._renderer.setSize(window.innerWidth, window.innerHeight)\r\n    this._renderer.setPixelRatio(window.devicePixelRatio)\r\n    this._options.node.appendChild(this._renderer.domElement)\r\n    // this._scene.add(new THREE.AxesHelper(10))\r\n    this.initLight()\r\n    this.initControls()\r\n    this.initStats()\r\n    this.animate()\r\n    window.onresize = this.onWindowResize\r\n  }\r\n  /**\r\n   * @method initLight 初始化灯光\r\n   */\r\n  private initLight() {\r\n    this._scene.add(this._ambientLight)\r\n    this._directionalLight.position.set(0, 0, 1)\r\n    this._directionalLight.intensity = this._options.lightIntensity || 0.6\r\n    this._scene.add(this._directionalLight)\r\n  }\r\n  /**\r\n   * @method initControls 初始化轨道控制器\r\n   * @param enableDamping 启用阻尼效果\r\n   * @param dampingFactor 阻尼系数\r\n   * @param autoRotate 启用自动旋转\r\n   */\r\n  private initControls() {\r\n    const defaultOptions = this._options.controls || {}\r\n    this._controls.minDistance = defaultOptions.minDistance || 1\r\n    this._controls.maxDistance = defaultOptions.maxDistance || 10\r\n    this._controls.enablePan = defaultOptions.enablePan || true\r\n    this._controls.enableDamping = defaultOptions.enableDamping || true\r\n    this._controls.dampingFactor = defaultOptions.dampingFactor || 0.25\r\n    this._controls.autoRotate = defaultOptions.autoRotate || false\r\n  }\r\n  /**\r\n   * @method initControls 初始化性能监控\r\n   */\r\n  private initStats() {\r\n    this._stats.showPanel(1)\r\n    this._options.node.appendChild(this._stats.dom)\r\n  }\r\n  /**\r\n   * @method onWindowResize 窗口变动触发的函数\r\n   */\r\n  private onWindowResize = () => {\r\n    this._camera.aspect = window.innerWidth / window.innerHeight\r\n    this._camera.updateProjectionMatrix()\r\n    this.render()\r\n    this._renderer.setSize(window.innerWidth, window.innerHeight)\r\n  }\r\n  /**\r\n   * @method render 渲染函数\r\n   */\r\n  private render() {\r\n    this._renderer.render(this._scene, this._camera)\r\n  }\r\n  /**\r\n   * @method animate 动画\r\n   */\r\n  private animate = () => {\r\n    this.render()\r\n    this._animateSign = requestAnimationFrame(this.animate)\r\n    this._stats.update()\r\n    this._controls.update()\r\n  }\r\n  initObject = (props: GeometryType) => {\r\n    this._scene.add(props.mesh)\r\n    if (props.animate || props.update) {\r\n      if (props.animate) props.animate(props.mesh)\r\n      cancelAnimationFrame(this._animateSign)\r\n      this.animate = () => {\r\n        this.render()\r\n        this._animateSign = requestAnimationFrame(this.animate)\r\n        this._stats.update()\r\n        this._controls.update()\r\n        if (props.update) props.update(props.mesh)\r\n      }\r\n      this.animate()\r\n    }\r\n  }\r\n  removeObject = (mesh: THREE.Mesh) => {\r\n    this._scene.remove(mesh)\r\n  }\r\n  destroy = () => {\r\n    cancelAnimationFrame(this._animateSign)\r\n  }\r\n}\r\n","import setPrototypeOf from \"./setPrototypeOf\";\n\nfunction isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport default function _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}","export default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}","export default function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}","module.exports = __webpack_public_path__ + \"static/media/disturb.f1b4c29e.jpg\";","import React, { Component } from 'react'\r\nimport InitCanvas from '../../common/initCanvas'\r\nimport * as THREE from 'three'\r\nimport texturesImage from '../../assets/img/disturb.jpg'\r\nimport { Button } from 'semantic-ui-react'\r\ninterface CanvasLineState {\r\n  canvas?: any,\r\n  mesh?: THREE.Mesh\r\n}\r\nclass UseTexture extends Component<{}, CanvasLineState> {\r\n  constructor(props: any) {\r\n    super(props)\r\n    this.state = {}\r\n  }\r\n  componentDidMount() {\r\n    const canvasNode = document.getElementById('Sweet-Kingdom')\r\n    const canvas = this.initCanvas(canvasNode)\r\n    canvas.initObject(this.objectOptions())\r\n  }\r\n  initCanvas = (canvasNode: any) => {\r\n    const options = {\r\n      node: canvasNode,\r\n      rendererOption: { antialias: true },\r\n      cameraOption: [45, window.innerWidth / window.innerHeight, 1, 4000],\r\n      cameraPosition: [0, 0, 3],\r\n      directionalLight: 0xffffff,\r\n      lightIntensity: 1.5\r\n    }\r\n    const canvas = new InitCanvas(options)\r\n    this.setState({ canvas: canvas })\r\n    return canvas\r\n  }\r\n  objectOptions = (image?: any) => {\r\n    const mesh = new THREE.Mesh()\r\n    const loader = new THREE.TextureLoader()\r\n    loader.load(\r\n      image || texturesImage,\r\n      function(texture) {\r\n        mesh.material = new THREE.MeshPhongMaterial({ map: texture })\r\n        mesh.geometry = new THREE.BoxBufferGeometry(1, 1, 1)\r\n      }\r\n    )\r\n    const objectOptions = {\r\n      mesh: mesh,\r\n      update: (Mesh: THREE.Mesh) => {\r\n        Mesh.rotation.x += 0.02\r\n        Mesh.rotation.y += 0.02\r\n      }\r\n    }\r\n    this.setState({ mesh: mesh })\r\n    return objectOptions\r\n  }\r\n  changeImage = (e: any) => {\r\n    const _this = this\r\n    const canvas = _this.state.canvas\r\n    const reads = new FileReader()\r\n    const file = e.target.files[0]\r\n    reads.readAsDataURL(file)\r\n    reads.onload = function() {\r\n      const base64 = this.result\r\n      canvas.removeObject(_this.state.mesh)\r\n      canvas.initObject(_this.objectOptions(base64))\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <>\r\n        <div className='fixed-top-right choose-image'>\r\n          <Button inverted color='violet'>换图</Button>\r\n          <input type='file' accept='image/*' id='file-honey' className='file-input' onChange={this.changeImage} />\r\n        </div>\r\n        <div id='Sweet-Kingdom'></div>\r\n      </>\r\n    )\r\n  }\r\n}\r\nexport default UseTexture"],"sourceRoot":""}