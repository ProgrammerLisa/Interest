{"version":3,"sources":["utils/request/config.ts","utils/request/index.ts","views/games/Gobang-online.tsx","views/games/Room.tsx","utils/api/chat.ts"],"names":["config","baseURL","testBaseURL","IP","testIP","fetch","axios","create","timeout","interceptors","request","use","method","data","headers","qs","stringify","error","Promise","reject","response","a","async","status","console","log","user","JSON","parse","localStorage","getItem","account","boardRow","boardColumn","Square","props","className","name","onClick","value","Checkerboard","i","type","key","this","square","columnSum","rowSum","num","columns","count","column","rows","row","push","renderSquare","renderRow","Component","Game","socket","ready","emit","beginGame","roomInfo","upperHand","setState","role","otherRole","nextPlayer","selfIsNext","canPlay","reset","state","winner","Array","defensive","handleSocket","setSquare","squareIndex","on","forEach","rule","contentMap","map","sub","join","replace","RegExp","member","calculateWinner","v","Button","inverted","color","hanldClick","userInfo","SearchRoom","search","add","Input","icon","iconPosition","label","tag","content","labelPosition","placeholder","sendValue","onChange","handelChage","errorStatus","React","WebSocket","initSocket","id","io","connectStatus","roomId","inputText","roomName","url","then","res","code","Date","getTime","e","target"],"mappings":"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","file":"static/js/12.fd7bcf5e.chunk.js","sourcesContent":["export const config = {\r\n  baseURL: 'http://111.229.226.139:9277',\r\n  testBaseURL: 'http://localhost:9277',\r\n  IP: '111.229.226.139:9277',\r\n  testIP: 'localhost:9277'\r\n}","import axios from 'axios'\r\nimport qs from 'qs'\r\nimport { config } from './config'\r\nlet fetch = axios.create({\r\n  baseURL: config.baseURL,\r\n  timeout: 30000\r\n})\r\n\r\nfetch.interceptors.request.use(config => {\r\n  if (config.method === 'post' || config.method === 'put' || config.method === 'delete') {\r\n    if (typeof(config.data) !== 'string' && config.headers['Content-Type'] !== 'multipart/form-data') {\r\n      config.data = qs.stringify(config.data)\r\n    }\r\n  }\r\n  return config\r\n}, error => {\r\n  Promise.reject(error)\r\n})\r\n\r\nfetch.interceptors.response.use(async data => {\r\n  return data.data\r\n}, error => {\r\n  if (error.response) {\r\n    if (error.response.status === 500) {\r\n      console.log('服务器错误，请联系管理员处理')\r\n    }\r\n    return Promise.reject(error.response.data)\r\n  } else {\r\n    return Promise.reject(error)\r\n  }\r\n})\r\n\r\nexport default fetch\r\n","import React, { Component } from 'react'\r\nimport { Button } from 'semantic-ui-react'\r\nimport '../../assets/sass/Gobang.css'\r\n\r\nconst user = JSON.parse((localStorage as any).getItem('kmr_userInfo')).account\r\n\r\nconst boardRow = 20\r\nconst boardColumn = 20\r\n\r\ninterface SquareType {\r\n  [index: number]: string\r\n}\r\n\r\ninterface SquareProps {\r\n  key: string,\r\n  name: string,\r\n  value: string,\r\n  onClick: () => void\r\n}\r\n\r\nfunction Square(props: SquareProps) {\r\n  return (\r\n    <button className={`square ${props.name}`} onClick={() => props.onClick()}>\r\n      {props.name === 'board-line' ? <span className={`piece ${props.value}`}></span> : ''}\r\n    </button>\r\n  )\r\n}\r\n\r\ninterface CheckerboardProps {\r\n  square: SquareType,\r\n  onClick: (i: number) => void,\r\n  column: number,\r\n  row: number\r\n}\r\n\r\nclass Checkerboard extends Component<CheckerboardProps, {}> {\r\n  renderSquare(i: number, type: string) {\r\n    return (\r\n      <Square key={`square${i}`} name={type} value={this.props.square[i]} onClick={() => {this.props.onClick(i)}} />\r\n    )\r\n  }\r\n  renderRow(type: string, columnSum: number, rowSum: number) {\r\n    let num = rowSum + 1\r\n    if (type === 'board-line') num = rowSum\r\n    let columns = [], count = 0\r\n    for (let column = 0; column < columnSum + 1; column++) {\r\n      let rows = []\r\n      for (let row = 0; row < num; row++) {\r\n        rows.push(this.renderSquare(count, type))\r\n        count++\r\n      }\r\n      columns.push(<div className=\"board-row\" key={`row${column}`}>{rows}</div>)\r\n    }\r\n    return columns\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"board-container\">\r\n        <div className=\"board-border\"></div>\r\n        <div className=\"board-foundation-container\">{this.renderRow('', this.props.column, this.props.row)}</div>\r\n        <div className=\"board-line-container\">{this.renderRow('board-line', this.props.column, this.props.row)}</div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ninterface GameProps {\r\n  socket: any,\r\n  userInfo: any,\r\n  roomId: string\r\n}\r\ninterface GameState {\r\n  winner: any,\r\n  column: number,\r\n  row: number,\r\n  square: SquareType,\r\n  selfIsNext: boolean,\r\n  role: string,\r\n  otherRole: string,\r\n  nextPlayer: string,\r\n  canPlay: boolean,\r\n  reset: boolean,\r\n  upperHand: string,\r\n  defensive: string\r\n}\r\n\r\nclass Game extends Component<GameProps, GameState> {\r\n  constructor(props: any) {\r\n    super(props)\r\n    this.state = {\r\n      winner: null,\r\n      column: boardColumn,\r\n      row: boardRow,\r\n      square: new Array(boardColumn * boardRow),\r\n      selfIsNext: false,\r\n      role: '',\r\n      otherRole: '',\r\n      nextPlayer: '',\r\n      canPlay: false,\r\n      reset: true,\r\n      upperHand: '',\r\n      defensive: ''\r\n    }\r\n  }\r\n\r\n  UNSAFE_componentWillMount() {\r\n    this.handleSocket()\r\n  }\r\n\r\n  ready = () => {\r\n    this.props.socket.emit('ready', user)\r\n  }\r\n\r\n  beginGame = (roomInfo: any) => {\r\n    if (user === roomInfo.upperHand) {\r\n      this.setState({\r\n        role: 'piece-black',\r\n        otherRole: 'piece-white',\r\n        nextPlayer: roomInfo.upperHand,\r\n        selfIsNext: true,\r\n        canPlay: true,\r\n        reset: false,\r\n        ...roomInfo\r\n      })\r\n    } else {\r\n      this.setState({\r\n        role: 'piece-white',\r\n        otherRole: 'piece-black',\r\n        nextPlayer: roomInfo.upperHand,\r\n        selfIsNext: false,\r\n        canPlay: false,\r\n        reset: false,\r\n        ...roomInfo\r\n      })\r\n    }\r\n    console.log(this.state)\r\n  }\r\n\r\n  hanldClick (i: number) {\r\n    const _this = this\r\n    const socket = this.props.socket\r\n    if (this.state.canPlay) {\r\n      this.setSquare(i, false)\r\n      socket.emit('finish', { nextPlayer: _this.state.nextPlayer, squareIndex: i })\r\n    }\r\n  }\r\n\r\n  handleSocket() {\r\n    const socket = this.props.socket\r\n    socket.on('finish', (data: any) => {\r\n      this.setSquare(data.squareIndex, true) \r\n    })\r\n    socket.on('beginGame', (data: any) => {\r\n      this.beginGame(data)\r\n    })\r\n    socket.on('reset', () => {\r\n      this.setState({\r\n        winner: null,\r\n        column: boardColumn,\r\n        row: boardRow,\r\n        square: new Array(boardColumn * boardRow),\r\n        selfIsNext: false,\r\n        role:  '',\r\n        otherRole:  '',\r\n        nextPlayer:  '',\r\n        canPlay: false,\r\n        reset: true,\r\n        upperHand: '',\r\n        defensive: ''\r\n      })\r\n    })\r\n  }\r\n\r\n  setSquare(i: number, state: boolean) {\r\n    let square = this.state.square\r\n    if (square[i]) return\r\n    square[i] = this.state.selfIsNext ? this.state.role : this.state.otherRole\r\n    let winner: any = ''\r\n    if (this.state.winner) {\r\n      return\r\n    } else {\r\n      winner = calculateWinner(square, i, this.state.row)\r\n      if (winner) {\r\n        winner.member.forEach((v: number) => {\r\n          square[v] = 'piece-winner'\r\n        })\r\n      } else {\r\n        let nextPlayer = this.state.nextPlayer === this.state.upperHand ? this.state.defensive : this.state.upperHand\r\n        this.setState({ nextPlayer: nextPlayer })\r\n      }\r\n    }\r\n    this.setState({\r\n      winner: winner,\r\n      reset: winner ? true : false,\r\n      square: square,\r\n      canPlay: state,\r\n      selfIsNext: !this.state.selfIsNext\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const winner = this.state.winner\r\n    let status\r\n    if (winner) {\r\n      status = 'winner --- ' + winner.winner\r\n    } else {\r\n      this.state.reset ? status = '' : status = '下一步 --- ' + (this.state.nextPlayer === user ? '我' : this.state.nextPlayer)\r\n    }\r\n    return (\r\n      <div>\r\n        <p>{status}</p>\r\n        {\r\n          this.state.reset ?\r\n          <p className=\"text-center\">\r\n            <Button inverted color='violet' onClick={this.ready}>进入房间\r\n              { winner ? '重新开始' : '开始' }\r\n            </Button>\r\n          </p> : null\r\n        }\r\n        <Checkerboard square={this.state.square} column={this.state.column} row={this.state.row} onClick={(i) => this.hanldClick(i)}></Checkerboard>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nfunction calculateWinner(square: SquareType, i: number, row: number) {\r\n  var winnerList = [\r\n    // 横向连接\r\n    [i, i + 1, i + 2, i + 3, i + 4],\r\n    [i - 1, i, i + 1, i + 2, i + 3],\r\n    [i - 2, i - 1, i, i + 1, i + 2],\r\n    [i - 3, i - 2, i - 1, i, i + 1],\r\n    [i - 4, i - 3, i - 2, i - 1, i],\r\n    // 纵向连接\r\n    [i, i + row, i + row*2, i + row*3, i + row*4],\r\n    [i - row, i, i + row, i + row*2, i + row*3],\r\n    [i - row*2, i - row, i, i + row, i + row*2],\r\n    [i - row*3, i - row*2, i - row, i, i + row],\r\n    [i - row*4, i - row*3, i - row*2, i - row, i],\r\n    // 左上-右下 斜向连接\r\n    [i, i + row + 1, i + 2*(row + 1), i + (row + 1)*3, i + (row + 1)*4],\r\n    [i - (row + 1), i, i + row + 1, i + 2*(row + 1), i + (row + 1)*3],\r\n    [i - (row + 1)*2, i - (row + 1), i, i + row + 1, i + 2*(row + 1)],\r\n    [i - (row + 1)*3, i - (row + 1)*2, i - (row + 1), i, i + row + 1],\r\n    [i - (row + 1)*4, i - (row + 1)*3, i - (row + 1)*2, i - (row + 1), i],\r\n    // 右上-左下 斜向连接\r\n    [i, i + row - 1, i + 2*(row - 1), i + (row - 1)*3, i + (row - 1)*4],\r\n    [i - (row - 1), i, i + row - 1, i + 2*(row - 1), i + (row - 1)*3],\r\n    [i - (row - 1)*2, i - (row - 1), i, i + row - 1, i + 2*(row - 1)],\r\n    [i - (row - 1)*3, i - (row - 1)*2, i - (row - 1), i, i + row - 1],\r\n    [i - (row - 1)*4, i - (row - 1)*3, i - (row - 1)*2, i - (row - 1), i]\r\n  ]\r\n  let winner = null\r\n  winnerList.forEach(rule => {\r\n    let contentMap = rule.map(sub => {\r\n      return square[sub]\r\n    })\r\n    if ((contentMap.join(',') + ',').replace(new RegExp(contentMap[0] + ',', 'gi'), '') === '') {\r\n      winner =  { winner: square[i], member: rule }\r\n    }\r\n  })\r\n  return winner\r\n}\r\n\r\nexport default Game","import * as React from 'react'\r\nimport io from 'socket.io-client'\r\nimport { Button, Input } from 'semantic-ui-react'\r\nimport { intoRoom, addRoom } from '../../utils/api/chat'\r\nimport { config } from '../../utils/request/config'\r\nimport Gobang from './Gobang-online'\r\n\r\n/*\r\nfunction renderMessageBox(props) {\r\n  let box = []\r\n  props.forEach((element, index) => {\r\n    box.push(<p key={`message${index}`}>{element}</p>)\r\n  })\r\n  return <div>{box}</div>\r\n}\r\n*/\r\n\r\nvar socket: any\r\nvar userInfo: any = JSON.parse((localStorage as any).getItem('kmr_userInfo'))\r\n\r\ninterface SearchRoomProps {\r\n  search: () => void,\r\n  add: () => void,\r\n  handelChage: (value: any) => void,\r\n  sendValue: string,\r\n  errorStatus: string\r\n}\r\n\r\nclass SearchRoom extends React.Component<SearchRoomProps, {}> {\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className='flex-between'>\r\n          <Button inverted color='violet' onClick={() => this.props.search()}>进入房间</Button>\r\n          <Button inverted color='purple' onClick={() => this.props.add()}>创建房间</Button>\r\n        </div>\r\n        <Input\r\n          icon='hand point left outline'\r\n          iconPosition='left'\r\n          label={{ tag: true, content: 'Go Fight !' }}\r\n          labelPosition='right'\r\n          placeholder='房间号'\r\n          value={this.props.sendValue}\r\n          onChange={(value) => this.props.handelChage(value)} />\r\n        <p>{this.props.errorStatus}</p>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\ninterface WebSocketProps {\r\n\r\n}\r\ninterface WebSocketState {\r\n  sendValue: string,\r\n  errorStatus: string,\r\n  connectStatus: boolean,\r\n  roomId: string\r\n}\r\nclass WebSocket extends React.Component<WebSocketProps, WebSocketState> {\r\n  constructor(props: WebSocketProps) {\r\n    super(props)\r\n    this.state = {\r\n      sendValue: '',\r\n      errorStatus: '',\r\n      connectStatus: false,\r\n      roomId: ''\r\n    }\r\n  }\r\n\r\n  initSocket = (id: string) => {\r\n    socket = io('ws://' + config.IP + '/' + id)\r\n    // 连接通讯之后 将当前用户记录在socket服务\r\n    socket.on('enter', () => {\r\n      this.setState({\r\n        connectStatus: true,\r\n        roomId: id\r\n      })\r\n      socket.emit('enter', userInfo.account)\r\n    })\r\n  }\r\n\r\n  search = () => {\r\n    const inputText = this.state.sendValue\r\n    if (inputText) {\r\n      intoRoom({ roomName: inputText, defensive: userInfo.account }).then(res => {\r\n        if ((res as any).code === 200) {\r\n          this.initSocket(res.data.roomId)\r\n        } else {\r\n          console.log(res)\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  add = () => {\r\n    const inputText = this.state.sendValue\r\n    if (inputText) {\r\n      addRoom({upperHand: userInfo.account, roomName: inputText, roomId: new Date().getTime()}).then(res => {\r\n        if ((res as any).code === 200) {\r\n          this.initSocket(res.data.roomId)\r\n        } else {\r\n          console.log(res)\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  handelChage = (e: any) => {\r\n    this.setState({\r\n      sendValue: e.target.value\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return this.state.connectStatus ? <Gobang userInfo={userInfo} roomId={this.state.roomId} socket={socket} /> :\r\n    <SearchRoom {...this.state} handelChage={this.handelChage} search={this.search} add={this.add} />\r\n  }\r\n}\r\n\r\nexport default WebSocket\r\n","import fetch from '../request/index'\r\n\r\nexport function intoRoom(data: any) {\r\n  return fetch({\r\n    url: '/api/chat/into_room',\r\n    method: 'post',\r\n    data: data\r\n  })\r\n}\r\n\r\nexport function addRoom(data: any) {\r\n  return fetch({\r\n    url: '/api/chat/add_room',\r\n    method: 'post',\r\n    data: data\r\n  })\r\n}\r\n"],"sourceRoot":""}